<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Simple FaaS UI</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background-color: #f4f4f8;
        margin: 0;
        padding: 20px;
      }

      h1 {
        text-align: center;
        color: #333;
      }

      .tabs {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
      }

      .tabs button {
        background-color: #fff;
        border: 1px solid #ccc;
        padding: 10px 20px;
        margin: 0 5px;
        cursor: pointer;
        border-radius: 5px;
        transition: all 0.2s ease;
      }

      .tabs button:hover {
        background-color: #e7e7ff;
        border-color: #888;
      }

      .tab {
        display: none;
        max-width: 600px;
        margin: 0 auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      .tab.active {
        display: block;
      }

      label {
        display: block;
        margin-bottom: 10px;
        color: #444;
      }

      input {
        width: 100%;
        padding: 8px;
        margin-top: 4px;
        margin-bottom: 15px;
        border-radius: 4px;
        border: 1px solid #ccc;
      }

      button[type="submit"] {
        background-color: #4f46e5;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
      }

      button[type="submit"]:hover {
        background-color: #3730a3;
      }

      ul {
        list-style-type: none;
        padding: 0;
      }

      li {
        background-color: #f0f0ff;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 5px;
      }

      #message {
        margin-top: 10px;
        color: green;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>Function-as-a-Service</h1>

    <div class="tabs">
      <button onclick="switchTab('create')">üõ† Create Function</button>
      <button onclick="switchTab('list')">üìã View Functions</button>
      <button onclick="switchTab('extra')">‚ú® Extra</button>
    </div>

    <!-- Create Tab -->
    <div id="create" class="tab active">
      <h2>Create a New Function</h2>
      <form id="function-form">
        <label
          >Name:
          <input type="text" name="name" required />
        </label>
        <label
          >Language:
          <input type="text" name="language" required />
        </label>
        <label
          >Code:
          <input type="text" name="code" required />
        </label>
        <label
          >Runtime:
          <input type="text" name="runtime" required />
        </label>
        <label
          >Timeout (in seconds):
          <input type="number" name="timeout" required />
        </label>
        <button type="submit">Submit</button>
      </form>
      <p id="message"></p>
    </div>

    <!-- List Tab -->
    <div id="list" class="tab">
      <h2>Available Functions</h2>
      <ul id="function-list"></ul>
    </div>

    <!-- Extra Tab -->
    <div id="extra" class="tab">
      <h2>Coming Soon üöÄ</h2>
      <p>We're working on more powerful features for your functions.</p>
    </div>

    <script>
      function switchTab(tabId) {
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.classList.remove("active");
        });
        document.getElementById(tabId).classList.add("active");

        if (tabId === "list") {
          fetchFunctions();
        }
      }

      document
        .getElementById("function-form")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const data = {
            name: this.elements["name"].value,
            language: this.elements["language"].value,
            code: this.elements["code"].value,
            runtime: this.elements["runtime"].value,
            timeout: parseInt(this.elements["timeout"].value),
          };

          const response = await fetch("/functions", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });

          const result = await response.json();
          document.getElementById("message").textContent = result.message;
          this.reset();
        });

      async function fetchFunctions() {
        const response = await fetch("/all-functions");
        const functions = await response.json();
        const list = document.getElementById("function-list");
        list.innerHTML = "";

        if (functions.length === 0) {
          list.innerHTML = "<li>No functions created yet.</li>";
          return;
        }

        functions.forEach((fn) => {
          const item = document.createElement("li");
          item.innerHTML = `
            <strong>${fn.name}</strong> (${fn.language})<br>
            Runtime: ${fn.runtime} | Timeout: ${fn.timeout}s<br>
            <button class="exec-btn" data-id="${fn.id}">‚ñ∂Ô∏è Execute</button>
            <button class="delete-btn" data-id="${fn.id}">üóëÔ∏è Delete</button>
            <p class="result"></p>
        `;
          list.appendChild(item);
        });
      }

      document.addEventListener("click", async function (e) {
        if (e.target.matches(".exec-btn")) {
          const funcId = e.target.getAttribute("data-id");
          const resultPara = e.target.nextElementSibling.nextElementSibling;
          const response = await fetch(`/execute/${funcId}`, {
            method: "POST",
          });
          const result = await response.json();
          console.log(result)
          resultPara.textContent = result.output;
          resultPara.style.color =
            result.output === undefined ? "red" : "green";
        }

        if (e.target.matches(".delete-btn")) {
          const funcId = e.target.getAttribute("data-id");
          const confirmed = confirm(
            "Are you sure you want to delete this function?",
          );
          if (!confirmed) return;

          const response = await fetch(`/functions/${funcId}`, {
            method: "DELETE",
          });
          const result = await response.json();

          fetchFunctions();
        }
      });
    </script>
  </body>
</html>
